<!DOCTYPE html>
<html lang="default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/wey_pixel_tinified.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/wey_pixel_tinified.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/wey_pixel_tinified.png">
  <link rel="mask-icon" href="/images/wey_pixel_tinified.png" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">
  <meta name="google-site-verification" content="XgZjCjedxF82a4b0z1Nr0FiopL5MQKta4RZweqPZaBY">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"note.siwei.info","root":"/","images":"/images","scheme":"Pisces","version":"8.2.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="I build things">
<meta property="og:type" content="website">
<meta property="og:title" content="Siwei Notes">
<meta property="og:url" content="https://note.siwei.info/index.html">
<meta property="og:site_name" content="Siwei Notes">
<meta property="og:description" content="I build things">
<meta property="og:locale">
<meta property="article:author" content="Wey Gu | 古思为">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://note.siwei.info/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'default'
  };
</script>
<title>Siwei Notes</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-659952-4"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-659952-4');
      }
    </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Siwei Notes" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Siwei Notes</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">思为笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-résumé"><a href="/resume/" rel="section"><i class="fa fa-book fa-fw"></i>Résumé</a></li>
        <li class="menu-item menu-item-简历"><a href="/resume_chs/" rel="section"><i class="fa fa-book fa-fw"></i>简历</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">29</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">4</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">14</span></a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
        <li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>Links</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wey Gu | 古思为"
      src="/images/wey_pixel_tinified.png">
  <p class="site-author-name" itemprop="name">Wey Gu | 古思为</p>
  <div class="site-description" itemprop="description">I build things</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wey-gu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wey-gu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:weyl.gu@gmail.com" title="E-Mail → mailto:weyl.gu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/siweigu" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;siweigu" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/wey_gu" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;wey_gu" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/Weyl.GU" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;Weyl.GU" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/siwei.gu" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;siwei.gu" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://note.siwei.info/atom.xml" title="RSS → https:&#x2F;&#x2F;note.siwei.info&#x2F;atom.xml"><i class="fa fa-rss rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/wey-gu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://note.siwei.info/pokemon-club-a-demo-app-with-nebula-graph/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wey_pixel_tinified.png">
      <meta itemprop="name" content="Wey Gu | 古思为">
      <meta itemprop="description" content="I build things">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Siwei Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/pokemon-club-a-demo-app-with-nebula-graph/" class="post-title-link" itemprop="url">Pokemon Club, a demo app with Nebula Graph</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-02-22 03:29:50" itemprop="dateCreated datePublished" datetime="2021-02-22T03:29:50+08:00">2021-02-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="About"><a href="#About" class="headerlink" title="About"></a>About</h2><p>In the database world, there is one type of NoSQL DB called graph database, which is good at the query of traversing relationships between small entities, like:</p>
<ul>
<li>Find one person’s 5th-degree friend connections in LinkedIn</li>
<li>Detect fraud, starting from one bank account number, connected to its account address, card owner’s social identity number, and recent bank activities, the all linked relationship graph can be queried in realtime and then checked towards certain fraud pattern</li>
</ul>
<p>Today, I will create a minimal PoC to build one tiny App leveraging a graph database, Nebula Graph.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/vesoft-inc">Nebula Graph</a> is an open-source new graph DB built natively for globally distributed deployment in hyper-scale, with the help of <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Raft_(algorithm)">raft consensus algorithm</a> and architecture of <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Shared-nothing_architecture">shared-nothing</a>, it’s like the <a target="_blank" rel="noopener" href="https://research.google.com/archive/spanner-osdi2012.pdf">Google Spanner</a> or CRDB/TiDB in the graph DB world.</p>
<h2 id="Pokemon-Club"><a href="#Pokemon-Club" class="headerlink" title="Pokemon Club"></a>Pokemon Club</h2><blockquote>
<p>Photo from <a target="_blank" rel="noopener" href="https://unsplash.com/@michaelrivera_ph">Michael Rivera 🇵🇭</a></p>
</blockquote>
<img data-src="/pokemon-club-a-demo-app-with-nebula-graph/michael-rivera-DypO_XgAE4Y-unsplash.jpg" class="pikachu">

<p>Today, let’s build a new SNS for the Pokemon Trainers, the Pokemon Club<del>house</del> ;)</p>
<p>Pokemon Club is targeting to connect all Pokemon Trainers for their meetup or grouping to fight in certain Pokemon Go Gym.</p>
<p>Like FB or Linkedin, we for sure have the User System with relational DB backed and users metadata of age, avatar, location, and Pokemons she owned, etc. Users as a trainer can create meetups and share posts in Pokemon Club and her friends can get the news feed and comment, join or chat to her.</p>
<p>Apart from the main features, we will only focus on one feature to help trainers explore new friends recommended by the App, based on the Pokemons this trainer owns.</p>
<p>Now we assume either in streaming/ real-time or the batch way, we had put trainer and pokemon relationship in our Nebula Graph DB, and then to create a humble API to get the recommended trainer friends:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;v1&#x2F;recommended_friends&#x2F;&lt;user&gt;</span><br><span class="line">     +</span><br><span class="line">     |          +--------------+         +----------------+</span><br><span class="line">     |          |              |         |                |</span><br><span class="line">     +----------&gt;  API Server  +---------&gt;  Nebula Graph  |</span><br><span class="line">                |              |         |                |</span><br><span class="line">                +--------------+         +----------------+</span><br></pre></td></tr></table></figure>
<p>Then let’s start the hands-on part!</p>
<h2 id="The-Hands-on-part"><a href="#The-Hands-on-part" class="headerlink" title="The Hands-on part!"></a>The Hands-on part!</h2><p>Let’s do bottom-up from the Nebula Graph DB:</p>
<h3 id="Deployment-of-Nebula-Graph"><a href="#Deployment-of-Nebula-Graph" class="headerlink" title="Deployment of Nebula Graph"></a>Deployment of Nebula Graph</h3><p>Nebula Graph is released in shapes from <a target="_blank" rel="noopener" href="https://docs.nebula-graph.io/manual-EN/3.build-develop-and-administration/1.build/1.build-source-code/">source code tarball</a>, [RPM/DEB package](RPM/DEB package), <a target="_blank" rel="noopener" href="https://hub.docker.com/r/vesoft/">Docker containers</a>, and <a target="_blank" rel="noopener" href="https://github.com/vesoft-inc/nebula-docker-compose">docker-compose</a> to <a target="_blank" rel="noopener" href="https://github.com/vesoft-inc/nebula/tree/master/kubernetes/helm">helm chart</a> or <a target="_blank" rel="noopener" href="https://medium.com/nebula-graph/nebula-operator-automated-the-nebula-graph-cluster-deployment-and-maintenance-on-k8s-2730987b8c42">a k8s CRD/operator</a>.</p>
<p>Here, we will start with the smallest footprint and the easiest way, the docker-compose fashion referring to <a target="_blank" rel="noopener" href="https://github.com/vesoft-inc/nebula-docker-compose">https://github.com/vesoft-inc/nebula-docker-compose</a>.</p>
<p>Here I spawned a preemptible(cheap, no SLA) VM from GCP for this ad-hoc purpose, with the spec of Intel CPU and 8GiB ram, in a Ubuntu 18.04 LTS image.</p>
<p>Also, I allowed TCP ports of 6996 and 7001 from the firewall setting associated with the VM.</p>
<p>Below is the deployment commands in this machine:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo su -i</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install docker.io docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># deploy a nebula cluster</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/vesoft-inc/nebula-docker-compose.git</span><br><span class="line"><span class="built_in">cd</span> nebula-docker-compose/</span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line">docker ps --filter health=healthy <span class="comment"># wait and verify that 3x graphd, 3x metad, 3x storaged are healthy</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deploy a nebula Studio</span></span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/vesoft-inc/nebula-web-docker.git</span><br><span class="line"><span class="built_in">cd</span> nebula-web-docker/v2</span><br><span class="line">docker-compose pull</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<h3 id="Nebula-Graph-Schema-and-Mock-Data-Import"><a href="#Nebula-Graph-Schema-and-Mock-Data-Import" class="headerlink" title="Nebula Graph Schema and Mock Data Import"></a>Nebula Graph Schema and Mock Data Import</h3><h4 id="Graph-Data-Schema"><a href="#Graph-Data-Schema" class="headerlink" title="Graph Data Schema"></a>Graph Data Schema</h4><p>Here we created the plainest schema with two types(tags) of vertices and two types of edges:</p>
<ul>
<li><p>Vertices:</p>
<ul>
<li>trainer<ul>
<li>property:<ul>
<li>name</li>
<li>…</li>
</ul>
</li>
</ul>
</li>
<li>pokemon<ul>
<li>property:<ul>
<li>name</li>
<li>…</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Edges:</p>
<ul>
<li>owns_pokemon<ul>
<li>source: trainer</li>
<li>dest: pokemon</li>
</ul>
</li>
<li>is_friend_with<ul>
<li>source: trainer</li>
<li>dest: trainer</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>From the below image, it’s easier for us to understand the schema:</p>
<img data-src="/pokemon-club-a-demo-app-with-nebula-graph/graph_schema.png" class="graph_schema">

<h4 id="Data-Import"><a href="#Data-Import" class="headerlink" title="Data Import"></a>Data Import</h4><p>For hyper-scale data migration into Nebula Graph, there is a <a target="_blank" rel="noopener" href="https://github.com/vesoft-inc/nebula-spark-utils">Spark utility</a> named Nebula Exchange to generate RocksDB SST files to enable extremely high import efficiency.</p>
<p>For a small scale of data, the utility <a target="_blank" rel="noopener" href="https://github.com/vesoft-inc/nebula-importer">nebula-importer</a> is enough, with which, we could define mapping rules in a yaml file and import CSV files.</p>
<p>Here we leverage a GUI utility in Nebula Studio as it comes with a guided process to define the mapping rule in the web console itself and call the underlying nebula-importer for us w/o composing the yaml file ;).</p>
<p>We have mocked data for importing as below:</p>
<ul>
<li>trainer–&gt;pokemon</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Tom,pikachu</span><br><span class="line">Tom,muk</span><br><span class="line">Jerry,weedle</span><br><span class="line">Jerry,pikachu</span><br><span class="line">Sue,pikachu</span><br><span class="line">Wey,pikachu</span><br><span class="line">Joe,koffing</span><br></pre></td></tr></table></figure>
<ul>
<li>trainer –&gt; trainer</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Tom,Jerry</span><br><span class="line">Sue,Wey</span><br></pre></td></tr></table></figure>
<p>Please refer to the video demo on how this mapping could be done in Nebula Studio :).</p>
<h3 id="Query-the-data-from-Nebula-Graph"><a href="#Query-the-data-from-Nebula-Graph" class="headerlink" title="Query the data from Nebula Graph"></a>Query the data from Nebula Graph</h3><p>Cool! Now we have a distributed graph DB with some data schema defined and some Pokemon Trainers data is also there!</p>
<p>To simplify the PoC, we assume that the recommendation API will query in this logic: </p>
<ul>
<li>For a given trainer Tom, what are those trainers own the same Pokemons Tom owned?</li>
</ul>
<p>I know it’s quite a silly logic though ;-), it’s just a minimal example here.</p>
<p>Nebula Graph comes with a SQL-like query language named nGQL, you can for sure refer to its doc <a target="_blank" rel="noopener" href="https://docs.nebula-graph.io/2.0/3.ngql-guide/2.nav.md/1.search-guide/">here</a>, and in the video, I showed you how to create a query with the help of the Explore GUI in Nebula Studio.</p>
<ul>
<li><code>owns_pokemon</code> is the edge</li>
<li>the query <code>OVER</code> it means to go <code>FROM</code> its source end, which is <code>trainer</code> tag</li>
<li>we <code>YIELD</code> its dest end, which is <code>pokemon</code> tag, as <code>pokemon_id</code></li>
<li>then we used <code>|</code> (<a target="_blank" rel="noopener" href="https://docs.nebula-graph.io/2.0/3.ngql-guide/5.operators/4.pipe/">pipe</a> operator) to pipe the query result in next query starting from the second <code>GO</code></li>
<li><code>$-</code> stands for the piped result namespace and wo start from <code>$-.pokemon_id</code> now</li>
<li>again we query <code>OVER</code> same edge with one extra <code>REVERSELY</code> key word, yes! it means the other direction this time: <code>FROM</code> its dest end!</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GO <span class="keyword">FROM</span> &quot;Tom&quot; <span class="keyword">OVER</span> owns_pokemon YIELD owns_pokemon._dst <span class="keyword">as</span> pokemon_id \</span><br><span class="line"><span class="operator">|</span> GO <span class="keyword">FROM</span> $<span class="operator">-</span>.pokemon_id <span class="keyword">OVER</span> owns_pokemon REVERSELY</span><br></pre></td></tr></table></figure>


<h3 id="The-API-code-handles-Web-Request-and-Invokes-Nebula-Graph"><a href="#The-API-code-handles-Web-Request-and-Invokes-Nebula-Graph" class="headerlink" title="The API code handles Web Request and Invokes Nebula Graph"></a>The API code handles Web Request and Invokes Nebula Graph</h3><p>There are <a target="_blank" rel="noopener" href="https://nebula-graph.io/download">different client libs</a> there and now we are using the Python one: <a target="_blank" rel="noopener" href="https://github.com/vesoft-inc/nebula-python">https://github.com/vesoft-inc/nebula-python</a>.</p>
<p>I created a simple Flask App with <code>nebula2-python</code> to call our Nebula Graph cluster, the main code logic is as below:</p>
<ul>
<li>it takes api query in format <code>/v1/recommended_friends/&lt;user&gt;</code> and returns result in JSON.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/v1/recommended_friends/&lt;user&gt;&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recommended_friends</span>(<span class="params">user</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get Recommended new Friends</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ng_credential = get_nebula_graph_crential()</span><br><span class="line">    session = connection_pool.get_session(*ng_credential)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session.execute(<span class="string">&#x27;USE pokemon_club&#x27;</span>)</span><br><span class="line">        query = (</span><br><span class="line">            <span class="string">f&#x27;GO FROM &quot;<span class="subst">&#123; user &#125;</span>&quot; &#x27;</span></span><br><span class="line">             <span class="string">&#x27;OVER owns_pokemon &#x27;</span></span><br><span class="line">             <span class="string">&#x27;YIELD owns_pokemon._dst as pokemon_id &#x27;</span></span><br><span class="line">             <span class="string">&#x27;| GO FROM $-.pokemon_id &#x27;</span></span><br><span class="line">             <span class="string">&#x27;OVER owns_pokemon REVERSELY&#x27;</span>)</span><br><span class="line">        query_result = session.execute(query)</span><br><span class="line">        trainers = [<span class="built_in">str</span>(trainer.values[<span class="number">0</span>].get_sVal(), <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">for</span> trainer <span class="keyword">in</span> query_result.rows()]</span><br><span class="line">        trainers = <span class="built_in">list</span>(<span class="built_in">set</span>(trainers))</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">in</span> trainers:</span><br><span class="line">            trainers.remove(user)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        session.release()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(trainers)</span><br></pre></td></tr></table></figure>
<p>After deployed it to Cloud Run and configured the Nebula Graph’s graphd endpoint in env of the cloud run instance, we will have an external URL to enable anyone in the word to query it, and it looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$curl</span> https://pokemon-club-v1-****-uw.a.run.app/v1/recommended_friends/Tom | jq</span><br><span class="line">[</span><br><span class="line">  <span class="string">&quot;Sue&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Wey&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Jerry&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Below are how I deployed it into GCP Cloud Run and I put all code in GitHub(<a target="_blank" rel="noopener" href="https://github.com/wey-gu/pokemon_club">https://github.com/wey-gu/pokemon_club</a>) as well.</p>
<blockquote>
<p>The Dockerfile</p>
</blockquote>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use Python37</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy requirements.txt to the docker image and install packages</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> requirements.txt /</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the WORKDIR to be the folder</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Expose port 5000</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">5000</span></span><br><span class="line"><span class="keyword">ENV</span> PORT <span class="number">5000</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nebula Graph</span></span><br><span class="line"><span class="keyword">ENV</span> NG_GCP_PROPJECT_ID=</span><br><span class="line"><span class="keyword">ENV</span> NG_GCP_PASSWORD_SECRET_ID=</span><br><span class="line"><span class="keyword">ENV</span> NG_GCP_USER_SECRET_ID=</span><br><span class="line"><span class="keyword">ENV</span> NG_GCP_CREDENTIAL_VERSION <span class="string">&quot;latest&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> NG_ENDPOINTS <span class="string">&quot;127.0.0.1:9669,&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> NG_MAX_CONN_POOL_SIZE <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use gunicorn as the entrypoint</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">exec</span> gunicorn --<span class="built_in">bind</span> :<span class="variable">$PORT</span> main:app --workers 1 --threads 1 --timeout 60</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>build and deploy container to Cloud Run</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PROPJECT_ID=&lt;GCP_PROJECT_ID&gt;</span><br><span class="line">docker build -t gcr.io/<span class="variable">$PROPJECT_ID</span>/pokemon_club:v1 . <span class="comment"># I know I shouldnt build on my own machine but I dont have time to use GCP Cloud Build :P</span></span><br><span class="line">docker push gcr.io/<span class="variable">$PROPJECT_ID</span>/pokemon_club:v1</span><br><span class="line"></span><br><span class="line">gcloud run deploy pokemon-club-v1 \</span><br><span class="line">    --image gcr.io/<span class="variable">$PROPJECT_ID</span>/pokemon_club:v1 \</span><br><span class="line">    --region us-west1 \</span><br><span class="line">    --platform managed \</span><br><span class="line">    --memory 128Mi</span><br></pre></td></tr></table></figure>


<h2 id="More-Working-In-Progress"><a href="#More-Working-In-Progress" class="headerlink" title="More Working In Progress"></a>More Working In Progress</h2><p>To Do:</p>
<ul>
<li><input disabled="" type="checkbox"> Video Demo(s)</li>
<li><input disabled="" type="checkbox"> Adding <del>Fraud</del> 🚀<a target="_blank" rel="noopener" href="https://bulbapedia.bulbagarden.net/wiki/Team_Rocket">Team Rocket</a> hidden member detection API, like based on who owns <a target="_blank" rel="noopener" href="https://pokeres.bastionbot.org/images/pokemon/109.png">Koffing</a></li>
<li><input disabled="" type="checkbox"> Front End Part<ul>
<li><input disabled="" type="checkbox"> Invoking Pokemon API<ul>
<li>catalog for human: <a target="_blank" rel="noopener" href="https://pokemondb.net/pokedex/national#gen-1">https://pokemondb.net/pokedex/national#gen-1</a></li>
<li>metadata fetching: <a target="_blank" rel="noopener" href="https://pokeapi.co/">https://pokeapi.co/</a></li>
<li>image fetching: <a target="_blank" rel="noopener" href="https://pokeres.bastionbot.org/images/pokemon/109.png">https://pokeres.bastionbot.org/images/pokemon/109.png</a> # <code>109</code> is Pokemon ID here.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="More-on-Nebula-Graph"><a href="#More-on-Nebula-Graph" class="headerlink" title="More on Nebula Graph"></a>More on Nebula Graph</h2><p>Nebula Graph is already used by some Gaint Companies and its community is quite active, with the help of that, it grows fast and comes with some great utilities like <a target="_blank" rel="noopener" href="https://github.com/vesoft-inc/nebula-spark-utils">an extremely fast batch importing tool</a>.</p>
<p>Apart from the k8s native deliverable, also it started to provide a managed service Graph DBaaS, in the test phase though.</p>
<p>Hopefully I could create more contents on Nebula Graph later :), stay tuned!</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://note.siwei.info/performance-optimization-refactor-in-large-python-codebase-a-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wey_pixel_tinified.png">
      <meta itemprop="name" content="Wey Gu | 古思为">
      <meta itemprop="description" content="I build things">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Siwei Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/performance-optimization-refactor-in-large-python-codebase-a-note/" class="post-title-link" itemprop="url">Performance Optimization refactor in Large Python Codebase, a note</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-08-18 20:09:58" itemprop="dateCreated datePublished" datetime="2020-08-18T20:09:58+08:00">2020-08-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Early this year, I had a chance to take a refactor task: one of our big downstream features doesn’t scale. Here I share some of my learning notes to potentially help you out there :-).</p>
<h2 id="Steps-to-follow"><a href="#Steps-to-follow" class="headerlink" title="Steps to follow"></a>Steps to follow</h2><h3 id="1-Runnable-Minimal-Reproduce"><a href="#1-Runnable-Minimal-Reproduce" class="headerlink" title="1. Runnable Minimal Reproduce"></a>1. Runnable Minimal Reproduce</h3><p>For a distributed system that required heavy hardware setup, or even worse, when you are trying to fix a case in the condition of a large scale, we need to have a runnable minimal reproduce(RMR) method to decouple the costly large scale of test environment/ production environment. A handy RMR is crucial as it brings us repeatability in circles of the rests steps.</p>
<p>In my case, when I started looking into this task, I found the only environment in hand was already quite expensive for the team (15+ servers, each of them is with 100+ GiB RAM and 40+ threads), yet it’s still far from the scale I am optimizing for(1000+ servers case).</p>
<blockquote>
<p>How to have a RMR?</p>
</blockquote>
<p>The answer could vary case by case:</p>
<ul>
<li>Buy/Pay-as-you-go-on-others-server 1000+ nodes cluster?<ul>
<li>This may be the best choice when you are in a cool organization working ;)</li>
</ul>
</li>
<li>Setup virtualized node cluster?<ul>
<li>In case you are dealing with the case you can semi-virtualize your environment to gain a 10/100 times scale yet with the closest to the real 1000+ node scale: use some efforts to set up 10 VMs on each bare-metal servers, that is, with 15+ servers you can reproduce the 150+ server issues. In my case, to create a virtualized environment is still very expensive as the workload we were working on depends on layers not that straightforward to be virtualized, and 150+ is still not enough for me.</li>
</ul>
</li>
<li>Mock it!<ul>
<li>I end up isolating the modular of code to be optimized, and, carefully mocking the interactions with other applications/ processes, with performance-wise mock.</li>
</ul>
</li>
</ul>
<p>With the RMR implemented, I put it in the existing UT code base with performance benchmark criteria as one of the assertions of the function I optimized. One of the reasons to trigger my putting RMR code in the codebase as UT is some of the surrounding mock utilities are there already, of course, the most important one is by doing so, these performance criteria will be always regression in every single commit merged to the codebase in future.</p>
<p>It’s worth mentioning that, during the implementation of RMR, there are some assumptions to be made, for example, the involved database, RESTful API, and RPC calls were mocked with sort of sleep in certain times, which was estimated based some experiments. The actual value may vary in different environments while values under some assumptions still can help us on some level of evaluation, yet, provide us comparison on before and after the refactoring (as of course, we use same assumptions).</p>
<h3 id="2-Profiling-and-analysis"><a href="#2-Profiling-and-analysis" class="headerlink" title="2. Profiling and analysis"></a>2. Profiling and analysis</h3><p>I started to have more of the whole-picture view of the function in two ways almost the same time: profiling and code reading.</p>
<p>Before profiling the function calls, I perceptually went through the code the feature and drew all call flows with time complexity with <a target="_blank" rel="noopener" href="http://asciiflow.com/">http://asciiflow.com/</a> like this:</p>
<img data-src="/performance-optimization-refactor-in-large-python-codebase-a-note/flow_ascii_blur.png" class="flow_ascii">

<p>Or drew it in whiteboard like this:</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/performance-optimization-refactor-in-large-python-codebase-a-note/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://note.siwei.info/setup-kolla-ansible-openstack-cluster-in-vagrant-2020/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wey_pixel_tinified.png">
      <meta itemprop="name" content="Wey Gu | 古思为">
      <meta itemprop="description" content="I build things">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Siwei Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/setup-kolla-ansible-openstack-cluster-in-vagrant-2020/" class="post-title-link" itemprop="url">Setup Kolla-ansible OpenStack Cluster in Vagrant 2020</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-26 18:31:36" itemprop="dateCreated datePublished" datetime="2020-05-26T18:31:36+08:00">2020-05-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This is a note on setting up kolla ansible openstack develop envrionment in your working machine.</p>
<p>I referred to this document: <a target="_blank" rel="noopener" href="https://docs.openstack.org/kolla-ansible/latest/contributor/vagrant-dev-env.html">https://docs.openstack.org/kolla-ansible/latest/contributor/vagrant-dev-env.html</a></p>
<p>I had done this in 2020 May on my old mac mini with Catalina ;-). With 20 GiB disk and 6GiB RAM assigned to one Vagrant spawned (virtualbox), the OpenStack Cluster is running pretty well, comparing to my previous setups ( multi-VMs based manually deployment and VM based Mirantis Fuel 9.0 deployment), it’s obviously more reponsive with the help of the single node setup.</p>
<p>Here I leave the notes as a reference for you to have a playground easier.</p>
<h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><h3 id="Install-vagrant-and-plugins-needed"><a href="#Install-vagrant-and-plugins-needed" class="headerlink" title="Install vagrant and plugins needed"></a>Install vagrant and plugins needed</h3><p>Below is an example to do this on a macOS machine, to do that from other OS, refer to <a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/installation/">here</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">brew cask install virtualbox vagrant</span><br><span class="line"></span><br><span class="line">vagrant plugin install vagrant-hostmanager vagrant-vbguest</span><br><span class="line"></span><br><span class="line"><span class="comment"># if we need to resize disks after vagrant up</span></span><br><span class="line">vagrant plugin install vagrant-disksize</span><br><span class="line"><span class="comment"># if we need to make vagrant VM behind a proxy</span></span><br><span class="line">vagrant plugin install vagrant-proxyconf</span><br></pre></td></tr></table></figure>
<h3 id="Clone-kolla-repo"><a href="#Clone-kolla-repo" class="headerlink" title="Clone kolla repo"></a>Clone kolla repo</h3><p>We need to clone below three repositories.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://opendev.org/openstack/kolla-cli</span><br><span class="line">git <span class="built_in">clone</span> https://opendev.org/openstack/kolla-ansible</span><br><span class="line">git <span class="built_in">clone</span> https://opendev.org/openstack/kolla</span><br></pre></td></tr></table></figure>
<h3 id="Customise-Vagrant-scripts"><a href="#Customise-Vagrant-scripts" class="headerlink" title="Customise Vagrant scripts"></a>Customise Vagrant scripts</h3><p>I found the configuration file out-of-box is no longer working/ out of repair for some time, below changes on <code>Vagrantfile</code>, <code>Vagrantfile.custom</code>,  and <code>bootstrap.sh</code> are needed.</p>
<p>For Vagrantfile.custom, we need to use Ubuntu 18.04 instead of 16.04, which comes with python3.6+ in apt repo.</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/setup-kolla-ansible-openstack-cluster-in-vagrant-2020/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wey Gu | 古思为</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>



<script>
if (document.querySelectorAll('.pdf-container').length) {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/pdfobject@2.2.4/pdfobject.min.js', () => {
    document.querySelectorAll('.pdf-container').forEach(element => {
      PDFObject.embed(element.dataset.target, element, {
        pdfOpenParams: {
          navpanes : 0,
          toolbar  : 0,
          statusbar: 0,
          pagemode : 'thumbs',
          view     : 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height   : element.dataset.height
      });
    });
  }, window.PDFObject);
}
</script>



  






</body>
</html>
